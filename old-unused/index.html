<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, shrink-to-fit=no, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Simple Sidebar - Start Bootstrap Template</title>

	<!-- Bootstrap Core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom CSS -->
	<link href="css/simple-sidebar.css" rel="stylesheet">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->
	
	<style>
		#ActiveGraphControl {
			margin:				0px;
			padding:			0px;
		}
		#ActiveGraphControl>div:nth-child(even) {
			background-color:	#DFDFDF;
		}
		#ActiveGraphControl>div:nth-child(odd) {
			background-color:	#D0D0D0;
		}
		#ActiveGraphControl>div {
			margin:				0px;
			padding:			5px;
			font-weight:		bold;
			text-decoration:	none;
		}
		#ActiveGraphControl>div:hover {
			background-color:	#AAAAAA;
			cursor:				pointer;
		}
		
		.popover {
			color: black;
			width: 200px;
		}
		
		.popover-title{
			background: #ffff99;
		}
		
		#ActiveGraphControl2>div>a {
			margin:				0px;
			width:				100%;
		}
	</style>
</head>

<body>
    <div id="wrapper" style="transition: width 0s;"> <!-- the transition effect breaks the graph -->

	<!-- Sidebar -->
	<div id="sidebar-wrapper">
		<ul class="sidebar-nav">
			<li class="sidebar-brand">
				<a href="#">
				SecureCloud
				</a>
			</li>
			<li>
				<a href="#">Graph</a>
			</li>
			<li>
				<a href="#">Statistics</a>
			</li>
			<li>
				<a href="#">Database Querry</a>
			</li>
			<li>
				<a href="#">User Control</a>
			</li>
		</ul>
	</div>
	<!-- /#sidebar-wrapper -->

	<!-- Modal -->
	<div id="myModal" class="modal fade" role="dialog">
		<div class="modal-dialog">

		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Graph Rendering options</h4>
			</div>
		
			<div class="modal-body">
				<p>
					Render style<br>
					<input type='radio' name='renderStyle'> <label>Lines</label>
					<br>
					<input type='radio' name='renderStyle' checked> <label>Areas</label>
					<hr>
					Render type<br>
					<input type='radio' name='renderType'> <label>Comparative</label>
					<br>
					<input type='radio' name='renderType' checked> <label>Stacked</label>
				</p>
			</div>
			
			<div class="modal-footer">
				<a href="#" class="btn btn-default" data-dismiss="modal" onclick="Graph.changeRenderMode(computeRenderMode());">Update</a>
			</div>
		</div>

		</div>
	</div>
	
	<!-- Page Content -->
	<div id="page-content-wrapper">
		<div class="container-fluid">
		<!-- ACTIVE GRAPH + SOURCES -->
			<div class="row">
				<div class="col-lg-10">
					<div class="panel panel-primary">
						<div class="panel-heading clearfix">
							<div class="row" style="vertical-align: middle;">
								<div class="col-sm-3">Flows Any</div>
								<div class="col-sm-5">
									<div id="TimeDisplay">
									</div>
								</div>
								<div class="col-sm-3">
									<div class="dropdown">
										<a href="#" class="dropdown-toggle" style="color: white;" type="button" data-toggle="dropdown">Display: <span id="DisplaySizePrint"></span>&nbsp;<span class="caret"></span></a>
										
										<ul class="dropdown-menu" id="DisplayResolutionList">
											<li><a href="#" onclick="setResolution(0);">12 Hours</a></li>
											<li><a href="#" onclick="setResolution(1);">1 Day</a></li>
											<li><a href="#" onclick="setResolution(2);">2 Day</a></li>
											<li><a href="#" onclick="setResolution(3);">4 Day</a></li>
											<li><a href="#" onclick="setResolution(4);">1 Week</a></li>
											<li><a href="#" onclick="setResolution(5);">2 Week</a></li>
											<li><a href="#" onclick="setResolution(6);">1 Month</a></li>
											<li><a href="#" onclick="setResolution(7);">2 Months</a></li>
											<li><a href="#" onclick="setResolution(8);">6 Months</a></li>
											<li><a href="#" onclick="setResolution(9);">8 Months</a></li>
											<li><a href="#" onclick="setResolution(10);">1 Year</a></li>
										</ul>
									</div>
								</div>
								<div class="col-sm-1 text-right">
									<a href="#" style="color: white;" data-toggle="modal" data-target="#myModal">
										<span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
									</a>
								</div>
							</div>
						</div>
						<div class="panel-body">
							
							<div id="wrapper222" style="left: 0px; position:relative; width: 100%; height: 500px;">
								<div id="GraphArea" style="position: absolute; width: 1000px; height: 500px;">
									<div id="GraphArea_Cursor1"></div>
									<div id="GraphArea_CurSpan"></div>
									<div id="GraphArea_Cursor2"></div>
								</div>
								<div id="dygraph" style="width: 100%; height: 500px;"></div>
							</div>
						</div>
						<div class="panel-footer">
							<!--div class="row text-center" id="ActiveGraphControl">
								<div class="col-xs-2">&lt;&lt;</div>
								<div class="col-xs-2">&lt;</div>
								<div class="col-xs-2">|</div>
								<div class="col-xs-2">&gt;</div>
								<div class="col-xs-2">&gt;&gt;</div>
								<div class="col-xs-2">&gt;|</div>
							</div-->
							<div class="btn-group btn-group-justified">
								<a href="#" class="btn btn-default"><span class="glyphicon glyphicon-backward"></span></a>
								<a href="#" class="btn btn-default"><span class="glyphicon glyphicon-zoom-in"></span></a>
								<a href="#" class="btn btn-default"><span class="glyphicon glyphicon-zoom-out"></span></a>
								<a href="#" class="btn btn-default"><span class="glyphicon glyphicon-forward"></span></a>
								<a href="#" class="btn btn-default"><span class="glyphicon glyphicon-step-forward"></span></a>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="panel panel-primary">
						<div class="panel-heading">
							Sources
						</div>
						<div class="panel-body">
							<div id="sources" onclick="Graph.toggleSources('sources');">
								<input type="checkbox" name="ssh" checked> <label>ssh</label><br>
								<input type="checkbox" name="smtp" checked> <label>smtp</label><br>
								<input type="checkbox" name="pop3" checked> <label>pop3</label><br>
								<input type="checkbox" name="imap" checked> <label>imap</label><br>
								<input type="checkbox" name="dns" checked> <label>dns</label><br>
								<input type="checkbox" name="ch1" checked> <label>ch1</label><br>
								<input type="checkbox" name="ch2" checked> <label>ch2</label><br>
							</div>
						</div>
						<div class="panel-footer">
							<a href="#" class="btn btn-default" style="width: 100%;">Update</a>
						</div>
					</div>
				</div>
			</div>
			
			<!-- THUMBNAILS -->
			<div class="row">
				<div class="col-md-3">
					<div class="panel panel-primary">
						<div class="panel-heading">
							Traffic Any
						</div>
						<div class="panel-body">
							<img src="image/img_sm.png" width="100%">
						</div>
					</div>
				</div>
				<div class="col-md-3">
					<div class="panel panel-primary">
						<div class="panel-heading">
							Packets Any
						</div>
						<div class="panel-body">
							<img src="image/img_sm.png" width="100%">
						</div>
					</div>
				</div>
				<div class="col-md-3">
					<div class="panel panel-primary">
						<div class="panel-heading">
							Traffic Max
						</div>
						<div class="panel-body">
							<img src="image/img_sm.png" width="100%">
						</div>
					</div>
				</div>
				<div class="col-md-3">
					<div class="panel panel-primary">
						<div class="panel-heading">
							Packets Max
						</div>
						<div class="panel-body">
							<img src="image/img_sm.png" width="100%">
						</div>
					</div>
				</div>
			</div>
			
			<a class="btn btn-default" id="menu-toggle" href="#menu-toggle">Toggle Menu</a>
		</div>
	</div>
	<!-- /#page-content-wrapper -->

	</div>
	<!-- /#wrapper -->

	<!-- jQuery -->
	<script src="js/jquery.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="js/bootstrap.min.js"></script>
	<script src="dygraph-combined.js"></script>
	<script src="graph.js"></script>
	<script src="data.js"></script>

	<!-- Menu Toggle Script -->
	<script>
	var minimumStepSize = 300;
	
	var resolution = [ 0.5 * 24, 24, 2 * 24, 7 * 24, 14 * 24, 30 * 24, (2 * 30 + 1) * 24, (6 * 30 + 3) * 24, (8 * 30 + 4) * 24, 365 * 24 ];
	
	function getCurrentTimestamp() {
		var d = new Date();
		var timestamp = Math.floor(d.getTime() / 1000);
		timestamp -= timestamp % minimumStepSize;
		return timestamp;
	}
	
	var timestampRight = getCurrentTimestamp();
	var timestampCenter = 0;
	var timestampLeft = timestampRight - 24 * 3600;
	
	function setResolution (index) {
		var list = document.getElementById("DisplayResolutionList").getElementsByTagName("a");
		
		for(var i = 0; i < list.length; i++) {
			if(list[i].className == "list-group-item active") {
				list[i].className = "";
				break;
			}
		}
		
		list[index].className = "list-group-item active";
		
		document.getElementById("DisplaySizePrint").innerHTML = list[index].innerHTML;
		
		var offset = resolution[i] * 1800; // * 3600 / 2 == * 1800
		timestampLeft = timestampCenter - offset;
		timestampRight = timestampCenter + offset;
		
		// TODO: Update data + graph
	}
	
	function timeWindowCallback() {
		var month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
		var day	= [ "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
	
		var doc = document.getElementById("TimeDisplay");
		
		doc.innerHTML = "TimeSelected: ";
		
		var d = new Date(Graph.curTime1 * 1000);
		var str = day[d.getDay()]+" "+month[d.getMonth()]+" "+d.getFullYear()+" "+('0'+d.getHours()).slice(-2)+":"+('0'+(d.getMinutes() - d.getMinutes() % 5)).slice(-2);
		doc.innerHTML += str;
		
		if(Graph.interval) {
			d = new Date(Graph.curTime2 * 1000);
			str = str = day[d.getDay()]+" "+month[d.getMonth()]+" "+d.getFullYear()+" "+('0'+d.getHours()).slice(-2)+":"+('0'+(d.getMinutes() - d.getMinutes() % 5)).slice(-2);
			doc.innerHTML += " - "+str;
		}
		else { // TODO: Check for reloading need
		}
	}
	
	function computeRenderMode() {
		var type = document.getElementsByName("renderType");
		var style= document.getElementsByName("renderStyle");
		
		var prms = {};
		
		var i;
		for(i = 0; i < type.length; i++) {
			if(type[i].checked) break;
		}
		prms["type"] = i;
		
		for(i = 0; i < style.length; i++) {
			if(style[i].checked) break;
		}
		prms["style"] = i;
		
		return prms;
	}
	
	$(document).ready(function(){
		$('[data-toggle="popover"]').popover();
		
		for(var x = 0; x < graphData.length; x++) {
			graphData[x][0] = new Date(parseInt(graphData[x][0]+"000"));
		}
		
		Graph.createGraph("dygraph", graphData, graphLegend, "Flows/s Any", computeRenderMode());
		Graph.initCursor("GraphArea_Cursor1", "GraphArea_Cursor2", "GraphArea_CurSpan");
		Graph.initTime(1468228560, 1468243560);
		
		document.getElementById("dygraph").onmousedown = Graph.moveCursor;
		Graph.registerCallback(timeWindowCallback);
		
		setResolution(1);
		
		$(window).resize(function(){
			Graph.initCursor("GraphArea_Cursor1", "GraphArea_Cursor2", "GraphArea_CurSpan");
		});
	});
	
	$("#menu-toggle").click(function(e) {
		e.preventDefault();
		$("#wrapper").toggleClass("toggled");
	});
	</script>
</body>

</html>
