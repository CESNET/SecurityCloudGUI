function acquireGraphData(callback){var request=Utility.initAjax();request.onreadystatechange=function(){if(request.readyState==4){var out=request.responseText;var parsedOut=JSON.parse(out);graphData=parsedOut.data;graphLegend=parsedOut.meta.legend;callback();}}
var sources=ARR_SOURCES[0];for(var i=1;i<ARR_SOURCES.length;i++){sources+=":"+ARR_SOURCES[i];}
request.open("GET","php/async/graphCreate.php?var="+ARR_GRAPH_VARS[currentVar]+"&mode=image&profile="+PROFILE+"&sources="+sources+"&time="+timestampBgn+":"+timestampEnd,true);request.send();}
function setGraphCenter(newCenter){timestampBgn=newCenter-ARR_RESOLUTION[resolutionPtr]*1800;timestampEnd=newCenter+ARR_RESOLUTION[resolutionPtr]*1800;if(timestampEnd>Utility.getCurrentTimestamp()){timestampEnd=Utility.getCurrentTimestamp();}}
function colorizeSources(srcDomId){var list=document.getElementById(srcDomId).getElementsByTagName("span");var colours=Graph.dygraph.getColors();for(var i=0;i<list.length;i++){list[i].style.backgroundColor=colours[i];}}
function updateThumbs(){var list=document.getElementsByClassName("thumb-image");var sources=ARR_SOURCES[0];for(var i=1;i<ARR_SOURCES.length;i++){sources+=":"+ARR_SOURCES[i];}
for(var i=0;i<ARR_GRAPH_VARS.length;i++){list[i].src="php/async/graphCreate.php?var="+ARR_GRAPH_VARS[i]+"&mode=thumb&profile="+PROFILE+"&sources="+sources+"&time="+timestampBgn+":"+timestampEnd;}}
function setResolution(type,value){var list=document.getElementById("DisplayResolutionList").getElementsByTagName("a");var i;for(i=0;i<list.length;i++){if(list[i].className=="list-group-item active"){list[i].className="";break;}}
if(type=="relative"){resolutionPtr=i+value;if(resolutionPtr<0)resolutionPtr=0;else if(resolutionPtr>=list.length)resolutionPtr=list.length-1;}
else if(type=="absolute"){resolutionPtr=value;}
list[resolutionPtr].className="list-group-item active";document.getElementById("DisplaySizePrint").innerHTML=list[resolutionPtr].innerHTML;setGraphCenter(Graph.curTime1);acquireGraphData(updateGraph);}
function graphMoveStep(direction){if(direction<0){setGraphCenter(Graph.curTime1-ARR_RESOLUTION[resolutionPtr]*1800);}
else if(direction==0){setGraphCenter(Utility.getCurrentTimestamp());}
else{setGraphCenter(Graph.curTime1+ARR_RESOLUTION[resolutionPtr]*1800);}
acquireGraphData(updateGraph);}
function timeWindowHandle(){var month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var doc=document.getElementById("TimePickerDisplay");doc.readonly="false";var d=new Date(Graph.curTime1*1000);var str=('0'+d.getDate()).slice(-2)+" "+month[d.getMonth()]+" "+d.getFullYear()+" "+('0'+d.getHours()).slice(-2)+":"+('0'+d.getMinutes()).slice(-2);doc.value=str;if(Graph.interval){d=new Date(Graph.curTime2*1000);str=str=('0'+d.getDate()).slice(-2)+" "+month[d.getMonth()]+" "+d.getFullYear()+" "+('0'+d.getHours()).slice(-2)+":"+('0'+d.getMinutes()).slice(-2);doc.value+=" - "+str;}
else{var windowSize=timestampEnd-timestampBgn;var windowPos=Graph.curTime1-timestampBgn;var percentage=windowPos/windowSize*100;if(percentage<5||95<percentage){setGraphCenter(Graph.curTime1);acquireGraphData(updateGraph);}}
doc.readonly="true";}
function computeRenderMode(){var type=document.getElementsByName("renderType");var style=document.getElementsByName("renderStyle");var prms={};var i;for(i=0;i<type.length;i++){if(type[i].checked)break;}
prms["type"]=i;for(i=0;i<style.length;i++){if(style[i].checked)break;}
prms["style"]=i;return prms;}
function initializeGraph(){for(var x=0;x<graphData.length;x++){graphData[x][0]=new Date(parseInt(graphData[x][0]+"000"));}
Graph.init("dygraph",graphData,graphLegend,ARR_GRAPH_NAME[currentVar],computeRenderMode());Graph.initCursor(["GraphArea_Cursor1","GraphArea_Cursor2","GraphArea_CurSpan"]);Graph.initTime(graphData[0][0].getTime()/1000,graphData[graphData.length-1][0].getTime()/1000);document.getElementById("dygraph").onmousedown=Graph.moveCursor;Graph.registerCallback(timeWindowHandle);colorizeSources("Sources");timeWindowHandle();updateThumbs();Graph.updateSourcesVisibility("Sources");}
function updateGraph(){for(var x=0;x<graphData.length;x++){graphData[x][0]=new Date(parseInt(graphData[x][0]+"000"));}
Graph.update(graphData,ARR_GRAPH_NAME[currentVar],computeRenderMode());Graph.initCursor(["GraphArea_Cursor1","GraphArea_Cursor2","GraphArea_CurSpan"]);Graph.initTime(graphData[0][0].getTime()/1000,graphData[graphData.length-1][0].getTime()/1000);timeWindowHandle();updateThumbs();Graph.updateSourcesVisibility("Sources");}
function changeVariable(varPtr){currentVar=varPtr;document.getElementById("ActiveGraphLabel").innerHTML=ARR_GRAPH_NAME[currentVar];acquireGraphData(updateGraph);}